<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>BlueprintsManager</title>
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
          crossorigin="anonymous">
    <link rel="shortcut icon" th:href="@{'~/images/logo.png'}">
</head>
<body>
<div style="padding-left: 5%; padding-right: 5%" class="row row-no-gutters">
    <table id="table" class="table" style="border-bottom-width: 5px; border-bottom-color: black; width: 100%">
        <thead>
        <tr style="alignment: center">
            <td style="vertical-align: middle; width: 10%" class="text-left">
                <a href="/index">
                    <img width="100" src="../static/images/logo.png" th:src="@{~/images/logo.png}" class="rounded "
                         alt="logo">
                </a>
            </td>
            <td style="vertical-align: middle; width: 45%">
                <a href="/company">
                    <button type="button" class="btn btn-outline-secondary btn-lg btn-block">COMPANIES</button>
                </a>
            </td>
            <td style="vertical-align: middle; width: 45%">
                <a href="/user">
                    <button type="button" class="btn btn-outline-secondary btn-lg btn-block">USERS</button>
                </a>
            </td>
        </tr>
        </thead>
    </table>
</div>
<p></p>
<div style="padding-left: 5%; padding-right: 5%">
    <a th:href="@{'~/project/view/' + ${document.getProjectId()}}">
        <button type="button" class="btn btn-primary">BACK TO PROJECT</button>
    </a>
    <a th:href="@{'~/document/download/' + ${document.getId()}}">
        <button th:if="${documentExists}" type="button" class="btn btn-success">DOWNLOAD DOCUMENT</button>
    </a>
    <a th:href="@{'~/comment/document/' + ${document.getId()}}">
        <button type="button" class="btn btn-info">COMMENTS</button>
    </a>
    <h1 th:text="'DOCUMENT ' + ${document.getName()}"></h1>
    <h4 th:text="'Last edit at ' + ${document.getEditTimeWithFormat()}"></h4>
    <p th:if="${document.getReassemblyRequired() && documentExists}" class="alert alert-danger"
       th:text="'REASSEMBLY REQUIRED'"></p>
    <p th:text="${warningMessage}" th:if="${warningMessage ne null}" class="alert alert-danger"></p>

    <form action="#" method="post" th:action="@{/document/save}" th:object="${document}" enctype="multipart/form-data">
        <input th:field="*{id}" th:value="${document.getId()}" hidden>
        <input th:field="*{projectId}" th:value="${document.getProjectId()}" hidden>
        <input th:if="${documentExists}" th:field="*{type}" th:value="${document.getType()}" hidden>
        <input th:if="${documentExists}" th:field="*{reassemblyRequired}" th:value="${document.getReassemblyRequired()}" hidden>
        <div>
            <label>Document Name:</label>
            <input th:disabled="${disabled}" type="text" th:field="*{name}" th:placeholder="*{getName()}"/>
            <p th:if="${#fields.hasErrors('name')}" style="color: red">Document's name cannot be empty</p>
        </div>
        <div>
            <label>Document Type</label>
            <select th:disabled="${documentExists}" th:type="number" th:field="*{type}">
                <option th:value="${null}" selected hidden>
                    Please Choose Document Type
                </option>
                <option th:each="type : ${types}" th:selected="${type == document.getType()}" th:value="${type}"
                        th:text="${type.getName()}"
                        th:disabled="${type.isUnmodified()}"></option>
            </select>
            <p th:if="${#fields.hasErrors('type')}" style="color: red">Please Choose Document Type</p>
        </div>

        <div>
            <label>Designer</label>
            <select th:disabled="${disabled}" th:type="number" th:field="*{designerId}">
                <option th:each="user : ${users}" th:value="${user.getId()}" th:text="${user.getName()}"
                        th:selected="${user.getId() == document.getDesignerId()}"></option>
            </select>
        </div>
        <div>
            <label>Supervisor</label>
            <select th:disabled="${disabled}" th:type="number" th:field="*{supervisorId}">
                <option th:each="user : ${users}" th:value="${user.getId()}" th:text="${user.getName()}"
                        th:selected="${user.getId() == document.getSupervisorId()}"></option>
            </select>
        </div>
        <div>
            <label>Document Full Code:</label>
            <a th:text="${document.getDocumentFullCode()}"></a>
        </div>
        <div>
            <label>Document Code:</label>
            <input th:disabled="${disabled}" type="text" th:field="*{code}" th:placeholder="*{getCode()}"/>
            <p th:if="${#fields.hasErrors('code')}" style="color: red">Document's code cannot be empty</p>
        </div>
        <div th:if="${!documentExists || !document.getType().isUnmodified()}" class="form-group">
            <label>Select a file for upload</label>
            <label>*.txt only for General Information and *.pdf only for Drawing</label>
            <input th:disabled="${disabled}" type="file" name="file" class="form-control-file">
        </div>

        <button th:disabled="${disabled}" type="submit" class="btn btn-primary">SAVE</button>
    </form>

    <div th:if="${documentExists}">
        <a th:href="@{'~/document/edit/' + ${document.getId()}}">
            <button th:disabled="${document.getType().isUnmodified()}" type="button" class="btn btn-primary">EDIT
            </button>
        </a>
        <a th:href="@{'~/document/assemble/' + ${document.getId()}}">
            <button th:disabled="${!document.getReassemblyRequired()}" type="button" class="btn btn-warning">REASSEMBLE
                DOCUMENT
            </button>
        </a>
        <a th:href="@{'~/document/delete/' + ${document.getId()}}">
            <button th:disabled="${document.getType().isUnmodified()}" type="button" class="btn btn-danger">DELETE
                DOCUMENT
            </button>
        </a>
    </div>

</div>
</body>
</html>